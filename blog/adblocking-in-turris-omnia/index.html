<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">

        <!--
        <link rel="stylesheet" href="../../static/style.css">
        -->
        <!-- Bootstrap core CSS -->
        <link href="../../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom fonts for this template -->
        <link href="../../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- Custom styles for this template -->
        <link href="../../static/clean-blog.min.css" rel="stylesheet">

        <title>Adblocking in Turris Omnia â€” miblog</title>
    </head>

    <body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
        <div class="container">
            <a class="navbar-brand" href="index.html">MIBLOG</a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fa fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    
                    <li class="nav-item" endif
                        %}><a class="nav-link" href="../../">Home</a></li>
                    
                    <li class="nav-item" endif
                        %}><a class="nav-link" href="../../blog/">Blog</a></li>
                    
                    <li class="nav-item" endif
                        %}><a class="nav-link" href="../../projects/">Projects</a></li>
                    
                    <li class="nav-item" endif
                        %}><a class="nav-link" href="../../about/">About</a></li>
                    

                </ul>
            </div>
        </div>
    </nav>

    <!-- page header -->
    <header class="masthead" style="background-image: url('../../static/Lake_Hayes_by_queenstown.jpg')">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="site-heading">
              <h1>Miblog</h1>
              <!--
              <span class="subheading">Thoughts and ideas</span>
              -->
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- TODO: copy boostrap style -->
    <!-- Main Content -->
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
        
  
  <div class="blog-post">
  
    <h2>Adblocking in Turris Omnia</h2>
  
  <p class="meta">
    written by
    
      <a href="https://twitter.com/vyskocilm">Michal Vyskocil</a>
    
    on 2018-12-29
  </p>
  
  <p>
As a long time Firefox user I was horrified to use web browser with very limited blocking capabilities. However Samsung Browser is very handy tool for some sites. However the number of spam, scam, or porn pages and advertisements makes browsing there <strong>very</strong> unpleasant experience. Especially if your kids want to browse that way.
</p><p>
However I bought <a href="https://omnia.turris.cz">Turris Omnia</a> especially because I wanted to hack around.<br/>
<img src="https://omnia.turris.cz/static/img/banner-image.183819b04f00.jpg" alt="Turris Omnia Black"/><br/>
Source: <a href="https://turris.cz">turris.cz</a>
</p><h1>Options</h1><p>
As router provides Doman Name Service for all devices in local network, the most common way is to <strong>block</strong> DNS lookups for specified domains. It turns out there are three options available for Turris (or OpenWrt, the base operating system of Turris).

<ol>
<li><a href="https://pi-hole.net/">Pi Hole</a> (<a href="https://doc.turris.cz/doc/cs/public/pihole">Turris doc</a>)</li>
<li><a href="https://github.com/openwrt/packages/blob/master/net/adblock/files/README.md">OpenWrt Adblock</a> (<a href="https://doc.turris.cz/doc/en/public/adblock">Turris doc</a>)</li>
<li><a href="https://github.com/openwrt/packages/blob/master/net/simple-adblock/files/README.md">OpenWrt Simple Adblock</a> (Turris doc not available)</li>
</ol>
</p><p>
As user of Turris I can skip <code>simple-adblock</code> simply because it is not available there by default and it works with <em>dnsmasq</em> only. So there are two options only. And to be honest, simply reading the documentation it became clear that
 <dl>
  <dt>Pi Hole</dt>
  <dd>Is a complex solution with providing more than simple adblocking, including graphs, statistics and so. It must run in own LXC container and DHCP must be properly configured to be served by LXC container.</dd>
  <dt>Adblock</dt>
  <dd>Just install two packages <code>adblock</code> and <code>luci-app-adblock</code> and that's it. Adblock integrates with <code>kresd</code> (Knot DNS Resolver) natively, so there is very little to do.</dd>
</dl> 
In fact, <code>adblock</code> simply convert all the sources to <code>/etc/kresd/adb_list.overall</code>, which is <code>DENY</code> policy file for Knot resolver. For network tools blocked domains appears as not existing. 
</p><p><h2>Not everything is blocked</h2></p>
<p>
In theory community maintained lists shall be enough, but the disadvantage of adblock is that you never know if new source will block site you want to or not. I did not find better way than downloading all the lists from <a href="https://github.com/openwrt/packages/blob/master/net/adblock/files/adblock.conf">adblock.conf</a> and grepping the results. Fortunately <code>adblock</code> comes with local blacklist, so admin can block additional domains by editing <code>/etc/adblock/adblock.blacklist</code>.
</p><p>
So surprisingly, thanks OpenWrt community, is adblocking on router almost easy as installing extension for the browser.
</p><p>
<img src="screenshot_2018-12-29-turris-overview-luci.png"/>
</p>
  
  </div>


        </div>
      </div>
    </div>

    <hr>

    <!-- footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <ul class="list-inline text-center">
              <li class="list-inline-item">
                <a href="mailto:michal.vyskocil@gmail.com">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-mail fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://twitter.com/vyskocilm">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/vyskocilm">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://www.facebook.com/michal.vyskocil.148">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
            </ul>
            <p class="copyright text-muted">Copyright &copy; Michal Vyskocil 2018.<br/>Based on <a href="https://startbootstrap.com/template-overviews/clean-blog/">Bootstrap Clean Blog</a>, powered by <a href="https://getlektor.com">Lektor SCM</a></p>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="../../vendor/jquery/jquery.min.js"></script>
    <script src="../../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="../../static/clean-blog.min.js"></script>
    </body>

</html>
